<main class="background-image">
  <div class="container">
    <br>
    <h1 style="size: 20rem;" class="text-align font-weight-bold">{{anime.title_english}} ({{anime.title}})</h1>

    <div class="row">
      <div class="col">
        <div class="d-inline-block" *ngFor="let genre of anime.genres">
          <p class="m-1 p-1 border border-primary rounded">{{genre.name}}</p>
        </div>
      </div>
      <div *ngIf="res == false" class="col">
        <div class="d-flex justify-content-end align-items-center">
          <button (click)="addAnime(anime)" class="btn btn-primary">
            <i class="fa fa-plus"></i>
          </button>
          <div class="ml-1">
            <p class="mb-0">Add anime</p>
          </div>
        </div>
      </div>

      <div *ngIf="res == true" class="col">
        <div class="d-flex justify-content-end align-items-center">
          <button (click)="deleteAnime(anime)" class="btn btn-primary">
            <i class="fa fa-minus"></i>
          </button>
          <div class="ml-1">
            <p class="mb-0">Delete movie</p>
          </div>
        </div>
      </div>
    </div>

    <h2 class="ml-3 mt-5 font-weight-bold">Background</h2>
    <p class="indent">{{anime.background}}</p>

    <h2 class="ml-3 mt-5 font-weight-bold">Plot</h2>
    <p class="indent-paragraph">{{anime.synopsis}}</p>

    <div class="row">
      <div class="col-4">
        <img src="{{anime.images!.jpg!.large_image_url || './assets/user.png'}}" alt="{{anime.title}}"
          class="img-fluid">
      </div>
      <div class="col-8">

        <div *ngIf="anime.trailer!.embed_url!" class="embed-responsive embed-responsive-4by3">
          <iframe allowfullscreen class="embed-responsive-item" [src]="anime.trailer?.embed_url! | safe"></iframe>
          <!-- +'?autoplay=true'  allow="autoplay" -->
        </div>
      </div>
    </div>


    <!-- <div class="d-flex justify-content-between"> -->
    <h2 class="ml-3 mt-5 font-weight-bold">Other informations</h2>
    <h5>Type of transmission: {{anime.type}}</h5>
    <h5>Source: {{anime.source}}</h5>
    <h5>Episodes: {{anime.episodes}} episodes</h5>
    <h5>Duration: {{anime.duration}}</h5>
    <h5>Status: {{anime.status}}</h5>
    <h5>Aired: {{anime.aired?.string}}</h5>
    <h5>Broadcast: {{anime.broadcast?.string}}</h5>
    <h5>Rating: {{anime.rating}}</h5>
    <div *ngIf="anime.producers && anime.producers.length > 0" class="row">
      <div class="col">
        <h5 class="d-inline">Producers: </h5>
        <div class="d-inline-block" *ngFor="let producer of anime.producers">
          <a href="{{producer.url}}" target="_blank">
            <h5 class="d-inline">{{producer.name}},</h5>
          </a>
        </div>
      </div>
    </div>
    <div *ngIf="anime.licensors && anime.licensors.length > 0" class="row">
      <div class="col">
        <h5 class="d-inline">Licensors: </h5>
        <div class="d-inline-block" *ngFor="let licensor of anime.licensors">
          <a href="{{licensor.url}}" target="_blank">
            <h5 class="d-inline">{{licensor.name}},</h5>
          </a>
        </div>
      </div>
    </div>
    <div *ngIf="anime.studios && anime.studios.length > 0" class="row">
      <div class="col">
        <h5 class="d-inline">Studios: </h5>
        <div class="d-inline-block" *ngFor="let studio of anime.studios">
          <a href="{{studio.url}}" target="_blank">
            <h5 class="d-inline">{{studio.name}},</h5>
          </a>
        </div>
      </div>
    </div>
    <div *ngIf="anime.themes && anime.themes.length > 0" class="row">
      <div class="col">
        <h5 class="d-inline">Themes: </h5>
        <div class="d-inline-block" *ngFor="let theme of anime.themes">
          <a href="{{theme.url}}" target="_blank">
            <h5 class="d-inline">{{theme.name}},</h5>
          </a>
        </div>
      </div>
    </div>
    <div *ngIf="anime.demographics && anime.demographics.length > 0" class="row">
      <div class="col">
        <h5 class="d-inline">Themes: </h5>
        <div class="d-inline-block" *ngFor="let demographic of anime.demographics">
          <a href="{{demographic.url}}" target="_blank">
            <h5 class="d-inline">{{demographic.name}},</h5>
          </a>
        </div>
      </div>
    </div>
    <h5>Score: {{anime.score}}/10 <i class="d-inline-block fa fa-star fa-1x" style="color: orange;"></i> (scored by {{anime.scored_by}} users)</h5>
    <h5>Ranked: #{{anime.rank}}</h5>
    <h5>Popularity: #{{anime.popularity}}</h5>
    <h5>Members: {{anime.members}}</h5>
    <div class="row">
      <div class="col">
        <h5 class="d-inline">MAL (My Anime List): </h5>
        <a href="{{anime.url}}" target="_blank">
          <h5 class="d-inline">{{anime.url}}</h5>
        </a>
      </div>
    </div>
    <br>
  </div>

  <div class="container mt-5" style="margin-bottom: 120px;">
    <h3 class="ml-3 mt-5 font-weight-bold ">Reviews</h3>
    <div *ngIf="reviews?.length !== 0">
      <div *ngFor="let review of reviews">
        <div class="review-box">
          <div class="left-column">
            <div class="user-info">
              <img src="{{review.user_photo || './assets/user.png'}}" alt="User Photo" class="user-photo">
              <div class="user-details">
                <h5 class="username">{{ review.username }}</h5>
                <h5 class="date">{{ review.reviewDate | date: 'd MMMM yyyy' }}</h5>
              </div>
            </div>
          </div>
          <div class="right-column">
            <div class="review-content">
              <h4 class="short-description">{{ review.short_description }}</h4>
              <div class="rating">
                <ng-container *ngIf="review.stars">
                  <ng-container *ngFor="let _ of generateArray(review.stars)">
                    <span class="fa fa-star checked"></span>
                  </ng-container>
                </ng-container>
              </div>
              <p class="main-description">{{ review.main_description }}</p>
              <div class="like-dislike">
                <button (click)="likeReview(review)" class="btn btn-outline-primary mr-2">
                  <span class="fa fa-thumbs-up"></span> Like
                </button>
                <button (click)="dislikeReview(review)" class="btn btn-outline-danger">
                  <span class="fa fa-thumbs-down"></span> Dislike
                </button>
                <div class="like-label">
                  <span class="like-count">{{review.likes! - review.dislikes!}}</span>
                  <span class="like-label-text">Likes</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="reviews?.length === 0">
      <p>No reviews available. Be the first to leave a review!</p>
    </div>
    <br>
    
    <form [formGroup]="myForm" (ngSubmit)="onSubmit()" style="margin-bottom: 50px;">
      <div class="form-group">
        <label for="shortDescription">Short Description:</label>
        <input type="text" class="form-control" id="shortDescription" name="shortDescription" formControlName="short_description">
      </div>
      <div class="form-group">
        <label for="mainDescription">Main Description:</label>
        <textarea class="form-control" id="mainDescription" name="mainDescription" rows="5" formControlName="main_description"></textarea>
      </div>
      <div class="form-group">
        <label for="stars">Stars: </label>
        <app-star-rating #starRating [maxStars]="10" (ratingChanged)="onRatingChanged($event)"></app-star-rating>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>
</main>